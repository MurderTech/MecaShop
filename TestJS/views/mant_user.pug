extends base.pug

block content
  #capa.capaNone(onclick='closeNav()')
  form.js-form.col-12.col(style="text-align : center;margin-top:60px;")
    .form-group.card
      h1 Mantenimiento de Usuarios
  .row
    .col-8.col-sm-10.offset-sm-1.col-md-3.col-lg-3.ml-2
      input#userToFind.form-control.ml-2(type='search', placeholder='Buscar...', aria-label='Search')
    .col-2.col-sm-10.offset-sm-1.col-md-3.col-lg-3.ml-4
      button#btnBuscarUser.btn.btn-success(type='submit') Buscar
  .row.mt-3(id="js_mant_user")

  #mySidenav.sidenav(style='width:0px;')
    a.closebtn(href='javascript:void(0)', onclick='closeNav()') ×
    p Estatus
    p(onclick='cerrarSesion()') Salir
      .form-group.card
        h1 Iniciar Sesión
        .row
          .col-12.col-sm-12.col-md-12.col-lg-12
            label
              strong Usuario:
            input.js-user-value.form-control.col-6.offset-3(type="text", style="text-align:center;" id="txtUser")
            label
              strong Contraseña:
            input.js-pass-value.form-control.col-6.offset-3(type="password", style="text-align:center;" id="txtPass")
            button.btn.btn-primary.btn-block.mt-3.col-4.offset-4(type="button", style="margin-bottom:15px;" id="btnLogin") Iniciar


block extra_js
  script.
    $(document).ready(function(){
      //alert('Se ejecuta bien');
      //$("#js_ofertas").empty();
        
        $.ajax({
        data: {
        },
        url: './list_user',
        method: 'POST',
        
        success: function(datos){
          console.log(datos.user);
          console.log(datos.user.length);
          var i = 0;
          $("#js_mant_user").hide();
          while (i < datos.user.length){
            console.log(datos.user[i]);

            $("#js_mant_user").append(
              `<div class="card col-12 col-sm-12 col-md-6 col-lg-6" style="position:static;">
                <div class="row">
                  <div class="col-2">
                    <img class="img-card-css" src="images/${datos.user[i].usuario}.png" onerror="this.src='images/defaultuser.jpg'" style='margin-top:10px;'>
                  </div>
                  <div class="col-10">
                    <h3 class="title-css">${datos.user[i].nombre}</h3>
                    <div class="row">
                    <h5 class="col-4" style="text-align:left; font-size:15px;">Usuario:</h5><h5 style="text-align:left; font-size:15px;" class="col-8">${datos.user[i].usuario}</h5>
                    <h5 class="col-4" style="text-align:left; font-size:15px;">Email:</h5><h5 style="text-align:left; font-size:15px;" class="col-8">${datos.user[i].email}</h5>
                    <h5 class="col-4" style="text-align:left; font-size:15px;">Ident:</h5><h5 style="text-align:left; font-size:15px;" class="col-8">${datos.user[i].ruc}</h5>
                    <h5 class="col-4" style="text-align:left; font-size:15px;">Tipo de cuenta:</h5><h5 style="text-align:left; font-size:15px;" class="col-8">${tipoCuenta(datos.user[i].typeAcc)}</h5>
                    <h5 class="col-4" style="text-align:left; font-size:15px;">No. Usuario:</h5><h5 style="text-align:left; font-size:15px;" class="col-8">${datos.user[i].id}</h5>
                    <h5 class="col-4" style="text-align:left; font-size:15px;">Estatus:</h5><h5 style="text-align:left; font-size:15px;" class="col-8">${estatusACC(datos.user[i].estatus)}</h5>
                  </div>
                  <div class="row" onmouseover="$(this).css('opacity','1.0');" onmouseleave="$(this).css('opacity','0.5');" style="height: 50px; opacity:0.5">
                    <div class="col-4">
                      <div class="btn btn-secondary btn-block" style="width:100%;" onclick="editUser('${datos.user[i].id}','${datos.user[i].nombre}')">Editar</div>
                    </div>
                    <div class="col-5">
                      <div class="btn btn-danger btn-block" style="width:100%;" onclick="downUser('${datos.user[i].id}','${datos.user[i].nombre}')">Dar de baja</div>
                    </div>
                  </div>
                  <br>
                </div>
              </div>`
            );
            i++;
          }
          $("#js_mant_user").fadeIn(500);
        }
      });

    });
    function editUser(ID,NAME) {
      //alert(`Editar usuario ${ID}?`);
      openNav();
    }

    function downUser(ID,NAME){

      const swalWithBootstrapButtons = Swal.mixin({
        customClass: {
          confirmButton: 'btn btn-success',
          cancelButton: 'btn btn-danger'
        },
        buttonsStyling: false,
      })

      swalWithBootstrapButtons.fire({
        title: `Dar de baja a ${NAME}?`,
        text: 'Se anulara el inicio de sesion de este usuario.',
        type: 'warning',
        showCancelButton: true,
        confirmButtonText: 'Confirmar',
        cancelButtonText: 'Cancelar',
        reverseButtons: true
      }).then((result) => {
        if (result.value) {
          swalWithBootstrapButtons.fire(
            'Deleted!',
            'Your file has been deleted.',
            'success'
          )
          

        } else if (
          // Read more about handling dismissals
          result.dismiss === Swal.DismissReason.cancel
        ) {
          swalWithBootstrapButtons.fire(
            'Cancelled',
            'Your imaginary file is safe :)',
            'error'
          )
        }
      })
    }

    $('#btnBuscarUser').click(function(){
      //alert($('#userToFind').val());
      $.ajax({
        data: {
          clave: $("#userToFind").val(),
        },
        method: 'POST',
        url: './findUser',
        success: function(datos){
          //console.log(datos.findUser);
          //console.log(datos.findUser.length);
          if (datos.findUser.length > 0) {
           
            var i = 0;
            $("#js_mant_user").empty();
            $("#js_mant_user").hide();
            while (i < datos.findUser.length){
            console.log(datos.findUser[i]);

            $("#js_mant_user").append(
              `<div class="card col-12 col-sm-12 col-md-6 col-lg-6" style="position:static;">
                <div class="row">
                  <div class="col-2">
                    <img class="img-card-css" src="images/${datos.findUser[i].usuario}.png" onerror="this.src='images/defaultuser.jpg'" style='margin-top:10px;'>
                  </div>
                  <div class="col-10">
                    <h3 class="title-css">${datos.findUser[i].nombre}</h3>
                    <div class="row">
                    <h5 class="col-4" style="text-align:left; font-size:15px;">Usuario:</h5><h5 style="text-align:left; font-size:15px;" class="col-8">${datos.findUser[i].usuario}</h5>
                    <h5 class="col-4" style="text-align:left; font-size:15px;">Email:</h5><h5 style="text-align:left; font-size:15px;" class="col-8">${datos.findUser[i].email}</h5>
                    <h5 class="col-4" style="text-align:left; font-size:15px;">Ident:</h5><h5 style="text-align:left; font-size:15px;" class="col-8">${datos.findUser[i].ruc}</h5>
                    <h5 class="col-4" style="text-align:left; font-size:15px;">Tipo de cuenta:</h5><h5 style="text-align:left; font-size:15px;" class="col-8">${tipoCuenta(datos.findUser[i].typeAcc)}</h5>
                    <h5 class="col-4" style="text-align:left; font-size:15px;">No. Usuario:</h5><h5 style="text-align:left; font-size:15px;" class="col-8">${datos.findUser[i].id}</h5>
                    <h5 class="col-4" style="text-align:left; font-size:15px;">Estatus:</h5><h5 style="text-align:left; font-size:15px;" class="col-8">${estatusACC(datos.findUser[i].estatus)}</h5>
                  </div>
                  <div class="row" onmouseover="$(this).css('opacity','1.0');" onmouseleave="$(this).css('opacity','0.5');" style="height: 50px; opacity:0.5">
                    <div class="col-4">
                      <div class="btn btn-secondary btn-block" style="width:100%;" onclick="editUser('${datos.findUser[i].id}','${datos.findUser[i].nombre}')">Editar</div>
                    </div>
                    <div class="col-5">
                      <div class="btn btn-danger btn-block" style="width:100%;" onclick="downUser('${datos.findUser[i].id}','${datos.findUser[i].nombre}')">Dar de baja</div>
                    </div>
                  </div>
                  <br>
                </div>
              </div>`
              );
              i++;
            }
          $("#js_mant_user").fadeIn(500);
        } else {
          Swal.fire(
            'Sin resultados',
            'Intenta con otro usuario',
            'error'
          );
        }
      }
      
      });
    });

    function openNav() {
      if (document.getElementById("mySidenav").style.width == "0px"){
        $('#capa').fadeIn('slow');
        document.getElementById("capa").className = "capaBlock";
        document.getElementById("mySidenav").style.width = `90%`;
      } else {
        $('#capa').fadeOut('slow');
        document.getElementById("capa").className = "capaNone";
        document.getElementById("mySidenav").style.width = "0px";
      }
          
    }

    function closeNav() {
      $('#capa').fadeOut('slow');
      document.getElementById("capa").className = "capaNone";
      document.getElementById("mySidenav").style.width = "0px";
    }